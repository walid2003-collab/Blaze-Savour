{%- doc -%}
  Renders product badges for the product card.

  @param {object} product - The product object.
  @param {object} settings - The theme settings object.

  @example
  {% render 'product-card-badges', product: product, settings: settings %}
{%- enddoc -%}

{% liquid
  # Check if product is new (published within last 30 days)
  assign is_new_product = false
  if product.published_at
    assign now = 'now' | date: '%s' | times: 1
    assign published_timestamp = product.published_at | date: '%s' | times: 1
    assign seconds_in_30_days = 2592000
    assign time_diff = now | minus: published_timestamp
    if time_diff <= seconds_in_30_days
      assign is_new_product = true
    endif
  endif

  # Calculate sale percentage if product is on sale
  assign sale_percentage = 0
  if product.compare_at_price > product.price and product.available
    assign price_difference = product.compare_at_price | minus: product.price
    assign percentage = price_difference | times: 100.0 | divided_by: product.compare_at_price
    assign sale_percentage = percentage | round
  endif
%}

<div
  class="product-badges product-badges--{{ settings.badge_position }}"
  style="
    --badge-border-radius: {{ settings.badge_corner_radius }}px;
    --badge-font-family: var(--font-{{ settings.badge_font_family }}--family); --badge-font-weight: var(--font-{{ settings.badge_font_family }}--weight); --badge-text-transform: {{ settings.badge_text_transform }};
  "
>
  {%- if product.available == false or product.compare_at_price > product.price and product.available -%}
    <div
      class="
        product-badges__badge product-badges__badge--rectangle product-badges__badge--custom
        {% if product.available == false %} product-badges__badge--sold-out{% elsif product.compare_at_price > product.price %} product-badges__badge--sale{% endif %}
      "
    >
      {%- if product.available == false -%}
        SOLD OUT
      {%- elsif product.compare_at_price > product.price -%}
        {{ sale_percentage }}% OFF
      {%- endif -%}
    </div>
  {%- endif -%}
</div>

{%- if is_new_product -%}
  <div class="product-badges product-badges--bottom-left product-badges--new">
    <div class="product-badges__badge product-badges__badge--rectangle product-badges__badge--new">
      NEW
    </div>
  </div>
{%- endif -%}

{% stylesheet %}
  .product-badges {
    --badge-inset: max(var(--padding-xs), calc((var(--border-radius) + var(--padding-xs)) * (1 - cos(45deg))));

    position: absolute;
    z-index: var(--layer-flat);
  }

  .product-badges--bottom-left {
    bottom: calc(var(--badge-inset) + var(--padding-block-start));
    left: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges--top-left {
    top: calc(var(--badge-inset) + var(--padding-block-start));
    left: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges--top-right {
    top: calc(var(--badge-inset) + var(--padding-block-start));
    right: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges__badge {
    --badge-font-size: var(--font-size--xs);

    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--color-foreground);
    background: var(--color-background);
    font-size: var(--badge-font-size);
    font-family: var(--badge-font-family);
    font-weight: var(--badge-font-weight);
    text-transform: var(--badge-text-transform);
    border-radius: var(--badge-border-radius);
  }

  .product-badges__badge--rectangle {
    padding-block: var(--badge-rectangle-padding-block);
    padding-inline: var(--badge-rectangle-padding-inline);
  }

  /* Custom badge styling - white background, black text */
  .product-badges__badge--custom {
    background-color: #FFFFFF !important;
    color: #000000 !important;
    font-weight: 600;
    font-size: var(--font-size--xs);
    padding-block: 4px;
    padding-inline: 8px;
    border-radius: 4px;
  }

  /* SOLD OUT badge specific styling */
  .product-badges__badge--sold-out {
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* SALE badge specific styling */
  .product-badges__badge--sale {
    text-transform: uppercase;
  }

  /* NEW badge styling - white background, black text */
  .product-badges--new {
    z-index: calc(var(--layer-flat) + 1);
  }

  .product-badges__badge--new {
    background-color: #FFFFFF;
    color: #000000;
    font-weight: 600;
    font-size: var(--font-size--xs);
    padding-block: 4px;
    padding-inline: 8px;
    border-radius: 4px;
    text-transform: uppercase;
  }
{% endstylesheet %}
